<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Pomo-elm</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <script src="elm.js"></script>
  <script>
    var app = Elm.App.fullscreen()
    var context = new (window.AudioContext || window.webkitAudioContext)()

    function makeBeeper(context) {
      return {
        context: context,
        oscillator: null,
        play: function () {
          this.oscillator = context.createOscillator()
          this.oscillator.connect(context.destination);
          this.oscillator.frequency.value = 440;
          this.oscillator.start(0);

        },
        stop: function () {
          if (this.oscillator) {
            this.oscillator.stop()
          }
        }
      };
    }

    var beeper = makeBeeper(context)

    app.ports.beep.subscribe(function(play) {
      if (play) {
        beeper.play()
      } else if (!play) {
        beeper.stop()
      }
    })
    
    if (context) {
      console.log("Web Audio API available!")
    } else {
      console.error("Web Audio API not available")
    }

  </script>
</body>
</html>

